<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Mechanics/Settlement" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Settlement | Boros Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pendle.finance/Mechanics/Settlement"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Settlement | Boros Documentation"><meta data-rh="true" name="description" content="In Boros, settlement refers to position update when a trade happens (e.g. market order placed, limit order filled) and the periodic floating payment."><meta data-rh="true" property="og:description" content="In Boros, settlement refers to position update when a trade happens (e.g. market order placed, limit order filled) and the periodic floating payment."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pendle.finance/Mechanics/Settlement"><link data-rh="true" rel="alternate" href="https://pendle.finance/Mechanics/Settlement" hreflang="en"><link data-rh="true" rel="alternate" href="https://pendle.finance/Mechanics/Settlement" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Settlement","item":"https://pendle.finance/Mechanics/Settlement"}]}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.d2f9cb04.css">
<script src="/assets/js/runtime~main.073db375.js" defer="defer"></script>
<script src="/assets/js/main.477a8ae3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Boros Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Boros Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Boros Documentation</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LitePaper">Lite Paper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/HighLevelArchitecture">High Level Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Mechanics/OrderBook">Mechanics</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Mechanics/OrderBook">Order Book</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Mechanics/Settlement">Settlement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Mechanics/Fees">Fees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Mechanics/Margin">Margin</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Backend/REST API">Backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Contracts/Router">Contracts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/whitepapers" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Whitepapers<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://pendle.gitbook.io/boros" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Boros Academy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Mechanics</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Settlement</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Settlement</h1></header>
<p>In Boros, settlement refers to position update when a trade happens (e.g. market order placed, limit order filled) and the periodic floating payment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trade-settlement">Trade Settlement<a href="#trade-settlement" class="hash-link" aria-label="Direct link to Trade Settlement" title="Direct link to Trade Settlement">​</a></h3>
<p>When a trade is executed (e.g., a market order fills against limit orders), traders must pay an upfront fixed cost immediately. This upfront cost represents the present value of the fixed rate component of the interest rate swap for the remaining time to maturity.</p>
<p><strong>Formula:</strong></p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Upfront Cost</mtext><mo>=</mo><mtext>Order Size</mtext><mo>×</mo><mtext>Order Rate</mtext><mo>×</mo><mfrac><mtext>Time to Maturity</mtext><mtext>YEAR</mtext></mfrac></mrow><annotation encoding="application/x-tex">\text{Upfront Cost} = \text{Order Size} \times \text{Order Rate} \times \frac{\text{Time to Maturity}}{\text{YEAR}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Upfront Cost</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord text"><span class="mord">Order Size</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord text"><span class="mord">Order Rate</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">YEAR</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">Time to Maturity</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>Where:</p>
<ul>
<li><strong>Order Size</strong>: The notional amount of the trade</li>
<li><strong>Order Rate</strong>: The fixed interest rate agreed upon in the trade</li>
<li><strong>Time to Maturity</strong>: <code>maturity - latestFTime</code> (in seconds)<!-- -->
<ul>
<li><code>maturity</code>: The market&#x27;s expiration timestamp</li>
<li><code>latestFTime</code>: The timestamp of the last periodic payment</li>
</ul>
</li>
<li><strong>YEAR</strong>: 365 days in seconds (31,536,000)</li>
<li>Both <code>maturity</code> and <code>latestFTime</code> can be retrieved from <code>market.descriptor()</code></li>
</ul>
<p><strong>Example:</strong>
For a market with 8-hour payment periods:</p>
<ul>
<li>If current time is 10:00 UTC</li>
<li>The <code>latestFTime</code> would be 8:00 UTC (the last 8-hour boundary)</li>
</ul>
<p><strong>Direction of Payment:</strong></p>
<ul>
<li><strong>Long positions</strong>: Pay upfront cost to receive floating rate</li>
<li><strong>Short positions</strong>: Receive upfront cost to pay floating rate</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="floating-rate-settlement">Floating Rate Settlement<a href="#floating-rate-settlement" class="hash-link" aria-label="Direct link to Floating Rate Settlement" title="Direct link to Floating Rate Settlement">​</a></h3>
<p>Floating rate payments occur periodically (e.g., every 8 hours) to exchange the difference between fixed and floating rates. These payments are calculated based on the position size and the change in the floating index.</p>
<p><strong>Formula:</strong></p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Floating Payment</mtext><mo>=</mo><mtext>Signed Position Size</mtext><mo>×</mo><mi mathvariant="normal">Δ</mi><mtext>Floating Index</mtext></mrow><annotation encoding="application/x-tex">\text{Floating Payment} = \text{Signed Position Size} \times \Delta\text{Floating Index}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Floating Payment</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Signed Position Size</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord">Δ</span><span class="mord text"><span class="mord">Floating Index</span></span></span></span></span></span>
<p>Where:</p>
<ul>
<li><strong>Signed Position Size</strong>: Positive for long positions, negative for short positions</li>
<li><strong>ΔFloating Index</strong>: The change in floating index since the last settlement</li>
</ul>
<p><strong>Floating Index:</strong>
The floating index is a cumulative value that represents the total yield earned by 1 unit of the underlying asset since inception.</p>
<p><strong>Example:</strong>
Consider a perpetual futures funding rate scenario:</p>
<ul>
<li>If the funding rate on Binance for the last 8-hour epoch is 0.0001 (0.01%)</li>
<li>The ΔFloating Index would be 0.0001</li>
<li>A long position of 100 units would receive: <code>100 × 0.0001 = 0.01</code> units</li>
<li>A short position of 100 units would receive: <code>-100 × 0.0001 = -0.01</code> units (negative payment means paying)</li>
</ul>
<p><strong>Fees:</strong>
Floating payments are subject to settlement fees. For detailed fee structure, see <a href="/Mechanics/Fees">Fees</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="algorithm">Algorithm<a href="#algorithm" class="hash-link" aria-label="Direct link to Algorithm" title="Direct link to Algorithm">​</a></h2>
<p>In traditional order books, when a market order matches against limit orders, all makers&#x27; positions are updated immediately. On-chain, this becomes prohibitively expensive as a single order could match against hundreds or thousands of limit orders, each requiring storage updates. Boros solved this by using a lazy settlement process that defers the position update until the next time users interact with Boros.</p>
<p>Since the last time a user interacted with Boros, multiple events may have occurred that affect their position:</p>
<ul>
<li>Limit orders could have been filled</li>
<li>Floating rate settlements could have occurred</li>
<li>These events can interleave in complex patterns</li>
</ul>
<p>The settlement algorithm processes all pending events in chronological order to ensure correctness:</p>
<ol>
<li>
<p><strong>Event Collection</strong>: Gather all events since the user&#x27;s last settlement:</p>
<ul>
<li>Filled limit orders (grouped by the <code>fTime</code> when they were filled)</li>
<li>Floating payment settlements at each <code>fTime</code> boundary</li>
</ul>
</li>
<li>
<p><strong>Chronological Processing</strong>: Iterate through events by <code>fTime</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">For each fTime period:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  a. Process all filled orders from that period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Calculate and apply upfront costs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Update position sizes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b. Process floating payment for that period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Calculate payment based on position size at settlement time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Apply floating index changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c. Continue to next fTime period</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>State Update</strong>: After processing all events:</p>
<ul>
<li>Update user&#x27;s final position size</li>
<li>Update user&#x27;s cash balance</li>
<li>Update user&#x27;s last settlement timestamp</li>
</ul>
</li>
</ol>
<p><strong>Example Timeline:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">User last settled: 08:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current time: 18:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events to process:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 09:30: Limit order filled (100 units)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 16:00: Floating payment settlement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 17:15: Limit order filled (50 units)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing order:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Process fills from 08:00-16:00 period (100 units)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Process Floating payment at 16:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Process fills from 16:00-24:00 period (50 units)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Direct link to Notes" title="Direct link to Notes">​</a></h2>
<p>Due to lazy settlement, on-chain state may not reflect the latest position values and balances. Query functions ending with <code>NoSettle</code> return raw, unsettled data that may be outdated.</p>
<p><strong>Getting Up-to-Date Data:</strong></p>
<p>To retrieve current, accurate position information, you must first trigger settlement:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">IMarketHub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">marketHub</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">settleAllAndGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">acc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GetRequest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ZERO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MarketId</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ZERO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>You can also use the <a href="/Backend/REST API">REST API</a>, which provides accurate, up-to-date data without requiring manual settlement triggers.</p>
<p><strong>Strategic Position Management:</strong></p>
<p>Floating payments are calculated based on your position size at the exact payment timestamp. This creates an opportunity for strategic position management:</p>
<ul>
<li><strong>Avoiding Payments</strong>: You can close or reduce your position before the payment time to minimize floating payments</li>
<li><strong>Payment Timing</strong>: Payments occur at regular intervals (e.g., every 8 hours)</li>
<li><strong>Position Size Matters</strong>: Only the position size at the payment timestamp is used for calculation</li>
</ul>
<p><strong>Oracle Update Delays:</strong></p>
<p>In practice, Floating payments don&#x27;t occur at the exact period boundaries due to off-chain oracle update delays:</p>
<ul>
<li><strong>Expected Time</strong>: Payment for 8:00:00 boundary</li>
<li><strong>Actual Time</strong>: Usually occurs ~10 seconds later (e.g., 8:00:10)</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Mechanics/OrderBook"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Order Book</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Mechanics/Fees"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fees</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#trade-settlement" class="table-of-contents__link toc-highlight">Trade Settlement</a></li><li><a href="#floating-rate-settlement" class="table-of-contents__link toc-highlight">Floating Rate Settlement</a></li><li><a href="#algorithm" class="table-of-contents__link toc-highlight">Algorithm</a></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Pages</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://pendle.finance" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://boros.pendle.finance" target="_blank" rel="noopener noreferrer" class="footer__link-item">App<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/qshFxh6965/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/pendle_fi/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://t.me/pendlefinance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://medium.com/pendle/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://angel.co/company/pendle_finance/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.pendle.finance/brandguide" target="_blank" rel="noopener noreferrer" class="footer__link-item">Media Kit<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/pendle-finance/boros-core-public/tree/main/audits/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Audits<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>